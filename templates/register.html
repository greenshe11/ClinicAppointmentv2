<!DOCTYPE html>
<html>

<head>
     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
     <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
     <link rel="stylesheet" href="{{ url_for('static',filename='assets/bootstrap/css/bootstrap.min.css')}}">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
     <style>
          .divider:after,
          .divider:before {
               content: "";
               flex: 1;
               height: 1px;
               background: #eee;
          }

          .h-custom {
               height: calc(100% - 73px);
          }

          @media (max-width: 450px) {
               .h-custom {
                    height: 100%;
               }
          }

          #buttons {
               background-color: #00008b;
               color: white;
          }

          body {
              background: linear-gradient(to right, #00008b,  #87CEEB);
              font-family: 'Roboto', sans-serif;
          }

          .required {
               color: red;
               margin-right: 5px;
          }

          #caption {
               opacity: 0;
               animation: caption-animation 1s ease-in-out forwards;
             }
 
             @keyframes caption-animation {
               from {
                 opacity: 0;
                 transform: translateX(-100px);
               }
               to{
                 opacity: 1;
                 transform: translateX(0px)
               }
             }


            
                /* Invalid Input Effect */
          .invalid-input {
               border: 2px solid red;
               animation: shake 0.3s ease-in-out;
          }

          /* Shake Animation */
          @keyframes shake {
               0% {
                    transform: translateX(0);
               }

               25% {
                    transform: translateX(-5px);
               }

               50% {
                    transform: translateX(5px);
               }

               75% {
                    transform: translateX(-5px);
               }

               100% {
                    transform: translateX(0);
               }
          }

          /* Flash Animation */
          @keyframes flash {

               0%,
               100% {
                    background-color: white;
               }

               50% {
                    background-color: #ffcccc;
               }
          }

          /* Red Flash Effect */
          .flash {
               animation: flash 0.8s ease-in-out;
          }

     </style>
</head>

<body>
     <!-- Section: Design Block -->
     <section class="">
          <!-- Jumbotron --> 
          <div class="px-4 py-5 px-md-5 text-center text-lg-start">
               <div class="container">
                    <div class="row gx-lg-5 align-items-center">
                         <div class="col-lg-6 mb-5 mb-lg-0">
                              <h1 class="my-5 display-3 fw-bold ls-tight text-white" id="caption">
                                   Get checked now!<br />
                                   <span style="color: #87CEEB;">for your health</span>
                              </h1>
                              <!--<p style="color:#87CEEB ">
                                   Lorem ipsum dolor sit amet consectetur adipisicing elit.
                                   Eveniet, itaque accusantium odio, soluta, corrupti aliquam
                                   quibusdam tempora at cupiditate quis eum maiores libero
                                   veritatis? Dicta facilis sint aliquid ipsum atque?
                              </p>-->
                         </div>

                         <div class="col-lg-6 mb-5 mb-lg-0">
                              <div class="card">
                                   <div class="card-body py-5 px-md-5">
                                        <form>
                                             <!-- 2 column grid layout with text inputs for the first and last names -->
                                             <div class="row">
                                                  <div class="col-md-6 mb-4">
                                                       <div data-mdb-input-init class="form-outline">
                                                            <input type="text" id="firstname"
                                                                 class="form-control" required>
                                                            <label class="form-label" for="form3Example1"><span class="required">*</span>First
                                                                 name</label>
                                                       </div>
                                                  </div>
                                                  <div class="col-md-6 mb-4">
                                                       <div data-mdb-input-init class="form-outline">
                                                            <input type="text" id="lastname"
                                                                 class="form-control" required>
                                                            <label class="form-label" for="form3Example2"><span class="required">*</span>Last
                                                                 name</label>
                                                       </div>
                                                  </div>
                                             </div>

                                             <!-- Contact input -->
                                             <div data-mdb-input-init class="form-outline mb-4">
                                                  <div style="display: flex; flex-direction: row; align-items:center;">
                                                       <span style="color: gray; margin-right: 10px;">+63</span>
                                                       <input type="text" id="contact" class="form-control" maxlength="10" oninput="validatePhoneNumber()" required/>
                                                  </div>
                                                  <label class="form-label" for="form3Example3"><span class="required">*</span>Contact</label>
                                                  <p id="contact-warn" style="color: red; font-size: 12px;"></p>
                                             </div>

                                             <!-- Email input -->
                                             <div data-mdb-input-init class="form-outline mb-4">
                                                 
                                                  <input type="email" id="email" class="form-control" required/>
                                                  
                                                  <label class="form-label" for="form3Example3"><span class="required">*</span>Email address</label>
                                             </div>

                                             <!-- Password input -->
                                             <div data-mdb-input-init class="form-outline mb-4">
                                                  <input type="password" id="password1" class="form-control" required/>
                                                  <label class="form-label" for="form3Example4"><span class="required">*</span>Password</label>
                                             </div>

                                              <!-- Password input -->
                                              <div data-mdb-input-init class="form-outline mb-4">
                                                  <input type="password" id="password2" class="form-control" required/>
                                                  <label class="form-label" for="form3Example4"><span class="required">*</span>Confirm Password</label>
                                             </div>

                                             <!-- Submit button -->
                                             <button id="buttons" type="submit" data-mdb-button-init data-mdb-ripple-init
                                                  class="btn btn-block mb-4"  onclick="register(event)">
                                                  Sign up
                                             </button>

                                             <!-- Register buttons -->
                                              <hr>
                                             <div class="text-center">
                                                  <p class="small fw-bold mt-2 pt-1 mb-0">Go back to <a href="/login"
                                                       class="link-danger">Log in</a></p>
                                                  <!--<p>or sign up with:</p>
                                                  <button type="button" data-mdb-button-init data-mdb-ripple-init
                                                       class="btn btn-link btn-floating mx-1">
                                                       <i class="fab fa-facebook-f"></i>
                                                  </button>

                                                  <button type="button" data-mdb-button-init data-mdb-ripple-init
                                                       class="btn btn-link btn-floating mx-1">
                                                       <i class="fab fa-google"></i>
                                                  </button>

                                                  <button type="button" data-mdb-button-init data-mdb-ripple-init
                                                       class="btn btn-link btn-floating mx-1">
                                                       <i class="fab fa-twitter"></i>
                                                  </button>

                                                  <button type="button" data-mdb-button-init data-mdb-ripple-init
                                                       class="btn btn-link btn-floating mx-1">
                                                       <i class="fab fa-github"></i>
                                                  </button>-->
                                             </div>
                                        </form>
                                   </div>
                              </div>
                         </div>
                    </div>
               </div>
          </div>
          <!-- Jumbotron -->
     </section>
     <!-- Section: Design Block -->
     <script src="{{ url_for('static',filename='bootstrap.min.js')}}"></script>
     <script>

         
          function validatePhoneNumber() {
               const input = document.getElementById('contact');
               input.value = input.value.replace(/\D/g, '');  // Removes non-digit characters
               if (input.value.length > 10) {
                   input.value = input.value.slice(0, 10);    // Ensures max length is 10 digits
               }
          }
           
          /*
          function validateEmail (email) {
               // Regular expression for basic email validation
               const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
               
               // Test the input email against the regex
               if (emailRegex.test(email)) {
                    return true; // Email is valid
               } else {
                    return false; // Email is invalid
               }
          }
          */
          
          function toLogin(){
                    window.location.href = '/login';
          }

          async function register(event){
               event.preventDefault()

               const form = event.target.closest('form');

               if (!form.checkValidity()){
                    form.reportValidity();
                    return;
               }

               let data = undefined;
               const PatientName = document.getElementById("firstname").value
               const PatientLastName = document.getElementById("lastname").value
               const PatientContactNo = '63' + document.getElementById("contact").value
          
               const PatientEmail = document.getElementById("email").value
               
               const contactInput = document.getElementById('contact');
               const PatientPassword = document.getElementById("password1").value
               const PatientPasswordConfirm = document.getElementById("password2").value
               
               data = {PatientName, PatientLastName, PatientEmail, PatientPassword, PatientContactNo}

               const contact = document.getElementById("contact-warn");
               
             
               for (let key in data){
                    if (data[key] == ""){
                         //alert(`${key} cannot be empty` )
                         return;
                    } 
               }
               
               if (contactInput.value.length < 10){
                    //alert("Contact Number must be 10 digits.")
                    contact.innerHTML = "Contact number must be 10 digits";
                    contactInput.classList.add('invalid-input', 'flash');
                    contactInput.classList.add('is-invalid');

                    setTimeout(function() {
                         contact.innerHTML = ""; // Clear the error message after 3 seconds
                         contactInput.classList.remove('invalid-input', 'flash');
                    }, 3000);

                   

                    return null;
               }


               /*
               if (!validateEmail(PatientEmail)){
                    alert(`Email: ${PatientEmail} is not a valid email.` )
                    return null
               }
               */  


               if (PatientPassword!=PatientPasswordConfirm){
                    alert("Confirmed password must be the same password!")
                    return null
               }
                   

               //Submit To API
            
               try {
                    const response = await fetch('/api/patient?for=registration', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    });
          
                    if (!response.ok) {
                         throw new Error('Network response was not ok');
                    }

                    const result = await response.json();
                    console.log(result.hasOwnProperty('customError')) // Shows error created from server
                    //Debug
                    
                    if (result.hasOwnProperty('customError')) {
                         alert( result.customError)
                         return
                    }
                    

                    //alert('REGISTRATION IS A SUCCESS!')
                    window.location.href = '/login'
                    // Handle the result (e.g., show a success message to the user)
               } catch (error) {
                    console.error('Error:', error);
                    // Handle errors (e.g., show an error message to the user)
               }
              

               
      
               
          };
       
     
     </script>
</body>

</html>